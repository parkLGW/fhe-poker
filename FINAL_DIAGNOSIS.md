# ğŸ”¬ æœ€ç»ˆè¯Šæ–­: é”™è¯¯ 0x9de3392c

**æ—¥æœŸ**: 2025-10-21  
**çŠ¶æ€**: æ·±åº¦è°ƒæŸ¥ä¸­

---

## é—®é¢˜æ€»ç»“

åŠ æ³¨å’Œç¦»å¼€æ¸¸æˆéƒ½è¿”å›é”™è¯¯ `0x9de3392c`ï¼Œè¿™ä¸ªé”™è¯¯ï¼š
- âŒ ä¸åœ¨æˆ‘ä»¬çš„åˆçº¦ ABI ä¸­
- âŒ ä¸æ˜¯ Solidity æ ‡å‡†é”™è¯¯
- âŒ ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„è‡ªå®šä¹‰é”™è¯¯
- âœ… æ¥è‡ª FHEVM åº“å†…éƒ¨

---

## å…³é”®å‘ç°

### 1. é”™è¯¯æ¥æºç¡®è®¤

é”™è¯¯å‘ç”Ÿåœ¨ `_processBet` å‡½æ•°ä¸­çš„è¿™ä¸€è¡Œï¼š
```solidity
euint64 amount = FHE.fromExternal(encryptedAmount, inputProof);
```

è¿™æ˜¯ FHEVM åº“çš„å‡½æ•°ï¼Œç”¨äºéªŒè¯é›¶çŸ¥è¯†è¯æ˜å¹¶è½¬æ¢åŠ å¯†æ•°æ®ã€‚

### 2. å‰ç«¯æ•°æ®æ ¼å¼

å‰ç«¯å‘é€çš„æ•°æ®ï¼š
```
dataHex: 0xc128d21499bbecebfb565dbae98e8b980d979429cb000000000000aa36a70500
proofHex: 0x0101c128d21499bbecebfb565dbae98e8b980d979429cb000000000000aa36a70500d1ac0afdd015c3cfce9239f4e459ec17413c2c3983634d7ae2dfb199f2fef7493819738939aaef21ff312b58364d02b7529547cc0f72dc4cf0bb9f2f004f85df1c00
```

- `dataHex` é•¿åº¦: 66 (0x + 64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ = 32 å­—èŠ‚)
- `proofHex` é•¿åº¦: 258 (0x + 256 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ = 128 å­—èŠ‚)

### 3. åŠ å¯†å‚æ•°

å‰ç«¯ä½¿ç”¨ä»¥ä¸‹å‚æ•°åŠ å¯†ï¼š
```typescript
const input = instance.createEncryptedInput(contractAddress, userAddress);
input.add64(BigInt(value));
const encryptedInput = await input.encrypt();
```

å…¶ä¸­ï¼š
- `contractAddress`: `0x49871B66FEAfe19F60373000876Bb9c23b1ca39d` (æ–°éƒ¨ç½²çš„åˆçº¦)
- `userAddress`: ç”¨æˆ·çš„é’±åŒ…åœ°å€

---

## å¯èƒ½çš„åŸå› 

### åŸå›  1: FHEVM åº“ç‰ˆæœ¬ä¸åŒ¹é… (æœ€å¯èƒ½)

å‰ç«¯ä½¿ç”¨çš„ FHEVM åº“ç‰ˆæœ¬ä¸åˆçº¦ç¼–è¯‘æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬ä¸åŒ¹é…ã€‚

**è¯æ®**:
- å‰ç«¯ä½¿ç”¨ CDN ç‰ˆæœ¬: `https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.js`
- åˆçº¦ä½¿ç”¨çš„ FHEVM åº“ç‰ˆæœ¬æœªçŸ¥

### åŸå›  2: åŠ å¯†å‚æ•°ä¸åŒ¹é…

å‰ç«¯åŠ å¯†æ—¶ä½¿ç”¨çš„å‚æ•°ä¸åˆçº¦éªŒè¯æ—¶çš„å‚æ•°ä¸åŒ¹é…ã€‚

**å¯èƒ½çš„ä¸åŒ¹é…**:
- åˆçº¦åœ°å€ä¸åŒ
- ç”¨æˆ·åœ°å€ä¸åŒ
- åŠ å¯†æ–¹å¼ä¸åŒ

### åŸå›  3: è¯æ˜éªŒè¯å¤±è´¥

é›¶çŸ¥è¯†è¯æ˜éªŒè¯å¤±è´¥ï¼Œå¯èƒ½åŸå› ï¼š
- è¯æ˜è¿‡æœŸ
- è¯æ˜ä¸åŠ å¯†æ•°æ®ä¸åŒ¹é…
- è¯æ˜æ ¼å¼ä¸æ­£ç¡®

---

## å·²æ’é™¤çš„å¯èƒ½æ€§

âœ… å‰ç«¯é…ç½®æ­£ç¡®
- åˆçº¦åœ°å€å·²æ›´æ–°: `0x49871B66FEAfe19F60373000876Bb9c23b1ca39d`
- ABI å·²æ›´æ–°
- å¼€å‘æœåŠ¡å™¨å·²é‡å¯

âœ… åˆçº¦ä»£ç æ­£ç¡®
- æ‰€æœ‰ require è¯­å¥éƒ½åœ¨ `FHE.fromExternal()` ä¹‹å‰
- ä¿®é¥°ç¬¦æ£€æŸ¥éƒ½åœ¨å‡½æ•°å¼€å§‹å¤„

âœ… æ•°æ®æ ¼å¼æ­£ç¡®
- `dataHex` é•¿åº¦æ­£ç¡® (66)
- `proofHex` é•¿åº¦åˆç† (258)
- éƒ½æ˜¯æœ‰æ•ˆçš„ hex å­—ç¬¦ä¸²

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å°è¯•

1. **æ£€æŸ¥ FHEVM åº“ç‰ˆæœ¬**
   - æŸ¥çœ‹å‰ç«¯ä½¿ç”¨çš„ FHEVM åº“ç‰ˆæœ¬
   - æŸ¥çœ‹åˆçº¦ç¼–è¯‘æ—¶ä½¿ç”¨çš„ FHEVM åº“ç‰ˆæœ¬
   - ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´

2. **æŸ¥çœ‹ Etherscan äº¤æ˜“è¯¦æƒ…**
   - è®¿é—® https://sepolia.etherscan.io/
   - æœç´¢åˆçº¦åœ°å€: `0x49871B66FEAfe19F60373000876Bb9c23b1ca39d`
   - æŸ¥çœ‹å¤±è´¥çš„äº¤æ˜“
   - æŸ¥çœ‹ "Revert Reason" éƒ¨åˆ†

3. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   - åœ¨å‰ç«¯æ·»åŠ æ›´å¤šæ—¥å¿—
   - è®°å½•åŠ å¯†è¿‡ç¨‹çš„æ¯ä¸€æ­¥
   - è®°å½•å‘é€åˆ°åˆçº¦çš„ç¡®åˆ‡æ•°æ®

### å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ A: æ›´æ–° FHEVM åº“ç‰ˆæœ¬

```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬
npm list @fhevm/fhevmjs

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
npm install @fhevm/fhevmjs@latest
```

#### æ–¹æ¡ˆ B: ä½¿ç”¨ä¸åŒçš„åŠ å¯†æ–¹å¼

æŸ¥çœ‹ FHEVM æ–‡æ¡£ï¼Œçœ‹æ˜¯å¦æœ‰å…¶ä»–çš„åŠ å¯†æ–¹å¼ã€‚

#### æ–¹æ¡ˆ C: è”ç³» Zama æ”¯æŒ

å¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œï¼Œå¯èƒ½éœ€è¦è”ç³» Zama å®˜æ–¹æ”¯æŒã€‚

---

## æŠ€æœ¯ç»†èŠ‚

### é”™è¯¯ç­¾ååˆ†æ

```
é”™è¯¯ç­¾å: 0x9de3392c
é•¿åº¦: 4 å­—èŠ‚ (æ ‡å‡†é”™è¯¯é€‰æ‹©å™¨é•¿åº¦)
æ¥æº: FHEVM åº“å†…éƒ¨
```

### ç›¸å…³ä»£ç 

**åˆçº¦**:
```solidity
euint64 amount = FHE.fromExternal(encryptedAmount, inputProof);
```

**å‰ç«¯**:
```typescript
const encrypted = await fhevm.encryptBetAmount(amount);
const dataHex = ('0x' + Array.from(encrypted.data).map(b => b.toString(16).padStart(2, '0')).join('')) as `0x${string}`;
const proofHex = ('0x' + Array.from(encrypted.proof).map(b => b.toString(16).padStart(2, '0')).join('')) as `0x${string}`;
```

---

## ç›¸å…³æ–‡ä»¶

- `contracts/PokerTable.sol` - åˆçº¦ä»£ç 
- `frontend/src/lib/fhevm.ts` - FHEVM åˆå§‹åŒ–
- `frontend/src/pages/Game.tsx` - åŠ æ³¨é€»è¾‘
- `frontend/src/hooks/useFHEVM.ts` - FHEVM Hook


