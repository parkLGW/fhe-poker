# ⚡ 快速参考指南

## 问题1: 加注后没有反应

### 症状
```
用户操作: 点击"加注" → 输入金额 → 点击"确认"
结果: 没有任何反应 ❌
```

### 快速诊断
```
1. 打开浏览器控制台 (F12)
2. 查看是否有错误信息
3. 检查金额是否符合条件
```

### 修复内容
| 文件 | 修改 | 效果 |
|------|------|------|
| BettingPanel.tsx | 添加 alert 验证 | 显示错误提示 |
| Game.tsx | 添加 simulateContract | 捕获链上错误 |
| Game.tsx | 添加交易状态UI | 显示处理状态 |

### 修复后的行为
```
✅ 金额 < 最小值 → 显示 "❌ 最小加注金额为..."
✅ 金额 > 余额 → 显示 "❌ 余额不足！..."
✅ 金额有效 → 显示 "⏳ 交易处理中..."
✅ 交易失败 → 显示 "❌ 交易失败: [错误信息]"
```

---

## 问题2: 离开游戏返回首页

### 症状
```
用户操作: 点击"离开游戏"按钮
结果: 回到首页而不是大厅 ❌
      游戏没有退出 ❌
```

### 快速诊断
```
1. 检查浏览器地址栏
2. 查看是否在首页（钱包连接页面）
3. 检查合约中玩家是否仍在游戏中
```

### 修复内容
| 文件 | 修改 | 效果 |
|------|------|------|
| Game.tsx | 新增 handleLeaveGame | 调用合约 leaveTable |
| Game.tsx | 改进导航逻辑 | 返回大厅而不是首页 |
| Game.tsx | 添加交易等待 | 确保状态同步 |

### 修复后的行为
```
✅ 点击"离开游戏" → 返回游戏大厅
✅ 游戏进行中 → 提示用户确认
✅ 显示"⏳ 离开中..." → 交易处理中
✅ 玩家从合约中移除 → 状态正确
```

---

## 代码位置速查

### 问题1 修复位置
```
文件: frontend/src/components/game/BettingPanel.tsx
行数: 33-48
函数: handleBet()

文件: frontend/src/pages/Game.tsx
行数: 218-294
函数: handleBet()

文件: frontend/src/pages/Game.tsx
行数: 468-497
UI: 交易状态提示
```

### 问题2 修复位置
```
文件: frontend/src/pages/Game.tsx
行数: 218-278
函数: handleLeaveGame() [新增]

文件: frontend/src/pages/Game.tsx
行数: 393-400
UI: 离开游戏按钮
```

---

## 测试清单

### 测试问题1修复
- [ ] 输入 < 最小值 → 显示错误
- [ ] 输入 > 余额 → 显示错误
- [ ] 输入有效值 → 显示处理中
- [ ] 交易成功 → 游戏状态更新
- [ ] 交易失败 → 显示错误信息

### 测试问题2修复
- [ ] 点击离开 → 返回大厅
- [ ] 游戏中离开 → 提示确认
- [ ] 显示离开中 → 交易处理
- [ ] 玩家移除 → 合约状态正确
- [ ] 下次进入 → 无冲突

---

## 常见问题

### Q: 为什么还是没有反应？
A: 检查以下几点：
1. FHEVM 是否初始化完成（右下角显示 ✅ Ready）
2. 钱包是否连接
3. 网络是否正确（Sepolia 或本地网络）
4. 浏览器控制台是否有错误

### Q: 为什么返回首页？
A: 这是修复前的问题，已解决。现在应该返回大厅。
如果仍然返回首页，请检查：
1. 是否使用了最新的代码
2. 是否清除了浏览器缓存
3. 是否刷新了页面

### Q: 交易为什么失败？
A: 可能的原因：
1. 余额不足
2. 金额格式错误
3. 合约状态不对
4. 网络连接问题

查看错误信息获取具体原因。

---

## 关键改进

| 方面 | 修复前 | 修复后 |
|------|--------|--------|
| 用户反馈 | ❌ 无 | ✅ 详细 |
| 错误处理 | ❌ 基础 | ✅ 完善 |
| 交易监听 | ❌ 无 | ✅ 有 |
| 导航逻辑 | ❌ 错误 | ✅ 正确 |
| 代码质量 | ❌ 低 | ✅ 高 |

---

## 相关文档

- 📋 `PROBLEM_RESOLUTION_REPORT.md` - 完整问题解决报告
- 🔄 `BEFORE_AFTER_COMPARISON.md` - 修复前后对比
- ✅ `FIXES_SUMMARY.md` - 修复总结
- 🔍 `ISSUE_ANALYSIS.md` - 详细问题分析

---

## 联系方式

如有问题，请查看：
1. 浏览器控制台错误信息
2. 相关文档
3. 代码注释


