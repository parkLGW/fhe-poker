# ğŸ” Relayer 400 é”™è¯¯è°ƒè¯•æŒ‡å—

## é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:
```
POST https://relayer.testnet.zama.cloud/v1/input-proof 400 (Bad Request)
Error: Relayer didn't response correctly. Bad status . Content: 
{"message":"Transaction rejected: \"Input request failed: Transaction failed: Transaction failed: Failed to check contract code: backend connection task has stopped\""}
```

**å‘ç”Ÿæ—¶æœº**: åœ¨è°ƒç”¨ `encryptBuyIn()` åŠ å¯†ä¹°å…¥é‡‘é¢æ—¶

## ğŸ¯ ä½¿ç”¨è°ƒè¯•å·¥å…·

æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨çš„è°ƒè¯•å·¥å…·ï¼Œä¸ä¼šå½±å“ä½ ç°æœ‰çš„ä»£ç ã€‚

### æ­¥éª¤1: è®¿é—®è°ƒè¯•é¡µé¢

åœ¨å‰ç«¯æœåŠ¡å™¨è¿è¡Œæ—¶ï¼Œè®¿é—®ï¼š
```
http://localhost:5173/src/test-relayer-debug.html
```

### æ­¥éª¤2: è¿è¡Œæµ‹è¯•

è°ƒè¯•å·¥å…·æä¾›äº†5ä¸ªæµ‹è¯•æ­¥éª¤ï¼š

1. **æ­¥éª¤1: è¿æ¥é’±åŒ…** - éªŒè¯é’±åŒ…è¿æ¥å’Œç½‘ç»œ
2. **æ­¥éª¤2: æ£€æŸ¥SDKåŠ è½½** - ç¡®è®¤Relayer SDKæ­£ç¡®åŠ è½½
3. **æ­¥éª¤3: æµ‹è¯•Relayerè¿æ¥** - æµ‹è¯•ç›´æ¥è®¿é—®å’Œä»£ç†è®¿é—®
4. **æ­¥éª¤4: åˆå§‹åŒ–FHEVM** - å°è¯•ä¸åŒçš„é…ç½®åˆå§‹åŒ–
5. **æ­¥éª¤5: æµ‹è¯•åŠ å¯†** - å®é™…æµ‹è¯•åŠ å¯†åŠŸèƒ½

ä½ å¯ä»¥ï¼š
- é€æ­¥ç‚¹å‡»æ¯ä¸ªæµ‹è¯•æŒ‰é’®
- æˆ–ç‚¹å‡»"è¿è¡Œå…¨éƒ¨æµ‹è¯•"ä¸€æ¬¡æ€§è¿è¡Œ

### æ­¥éª¤3: æŸ¥çœ‹æ—¥å¿—

è°ƒè¯•å·¥å…·ä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- âœ… æˆåŠŸçš„æ“ä½œï¼ˆç»¿è‰²ï¼‰
- âŒ å¤±è´¥çš„æ“ä½œï¼ˆçº¢è‰²ï¼‰
- â„¹ï¸ ä¿¡æ¯æç¤ºï¼ˆé»„è‰²ï¼‰

## ğŸ” æ ¹æ®dev.mdçš„åˆ†æ

æ ¹æ®Zamaå®˜æ–¹æ–‡æ¡£ï¼Œè¿™ä¸ªé”™è¯¯çš„å¯èƒ½åŸå› ï¼š

### 1. **RelayeræœåŠ¡é—®é¢˜** ğŸš¨

**ç—‡çŠ¶**: "backend connection task has stopped"

**åŸå› **: 
- Zamaçš„Relayeråç«¯æœåŠ¡æš‚æ—¶ä¸å¯ç”¨
- è¿™æ˜¯åŸºç¡€è®¾æ–½é—®é¢˜ï¼Œä¸æ˜¯ä»£ç é—®é¢˜

**éªŒè¯æ–¹æ³•**:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
fetch('https://relayer.testnet.zama.cloud/v1/keyurl')
  .then(r => console.log('çŠ¶æ€:', r.status))
  .catch(e => console.log('é”™è¯¯:', e))
```

**è§£å†³æ–¹æ¡ˆ**:
- ç­‰å¾…Zamaä¿®å¤æœåŠ¡
- æ£€æŸ¥ [Zamaç¤¾åŒº](https://community.zama.ai/) æ˜¯å¦æœ‰å…¶ä»–äººæŠ¥å‘ŠåŒæ ·é—®é¢˜

### 2. **åŠ å¯†è¾“å…¥éªŒè¯é—®é¢˜** ğŸ”

æ ¹æ®dev.mdç¬¬2000-2130è¡Œï¼ŒåŠ å¯†è¾“å…¥éœ€è¦ï¼š

**å…³é”®è¦æ±‚**:
1. ä½¿ç”¨æ­£ç¡®çš„åˆçº¦åœ°å€
2. ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·åœ°å€
3. ç”Ÿæˆæœ‰æ•ˆçš„ZKPoKï¼ˆé›¶çŸ¥è¯†è¯æ˜ï¼‰

**éªŒè¯ä»£ç **:
```typescript
// æ­£ç¡®çš„åŠ å¯†æ–¹å¼ï¼ˆå‚è€ƒdev.mdç¬¬2037-2058è¡Œï¼‰
const input = fhevm.createEncryptedInput(contractAddress, userAddress);
input.add64(amount);
const encryptedInput = await input.encrypt();

// ä½¿ç”¨åŠ å¯†æ•°æ®
const handle = encryptedInput.handles[0];
const proof = encryptedInput.inputProof;
```

### 3. **ACLæƒé™é—®é¢˜** ğŸ”’

æ ¹æ®dev.mdç¬¬2133-2204è¡Œï¼ŒACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰å¯èƒ½å¯¼è‡´é—®é¢˜ï¼š

**å…³é”®ç‚¹**:
- åŠ å¯†æ•°æ®å¿…é¡»ç»‘å®šåˆ°æ­£ç¡®çš„åˆçº¦åœ°å€
- åŠ å¯†æ•°æ®å¿…é¡»ç»‘å®šåˆ°æ­£ç¡®çš„ç”¨æˆ·åœ°å€
- å¦‚æœåœ°å€ä¸åŒ¹é…ï¼Œä¼šå¯¼è‡´éªŒè¯å¤±è´¥

**æ£€æŸ¥æ¸…å•**:
```javascript
// 1. éªŒè¯åˆçº¦åœ°å€
console.log('åˆçº¦åœ°å€:', CONTRACT_ADDRESS);

// 2. éªŒè¯ç”¨æˆ·åœ°å€
console.log('ç”¨æˆ·åœ°å€:', userAddress);

// 3. éªŒè¯åœ°å€æ ¼å¼ï¼ˆå¿…é¡»æ˜¯æ ¡éªŒå’Œæ ¼å¼ï¼‰
const { getAddress } = require('ethers');
const checksumAddress = getAddress(userAddress);
console.log('æ ¡éªŒå’Œåœ°å€:', checksumAddress);
```

### 4. **ç½‘ç»œå’ŒCORSé—®é¢˜** ğŸŒ

**å¯èƒ½çš„é—®é¢˜**:
- Cloudflare WAFé˜»æ‹¦
- CORSç­–ç•¥é™åˆ¶
- ç½‘ç»œé˜²ç«å¢™

**è°ƒè¯•å·¥å…·ä¼šæµ‹è¯•**:
- ç›´æ¥è®¿é—®Relayer
- é€šè¿‡Viteä»£ç†è®¿é—®
- CORSå¤´æ£€æŸ¥

## ğŸ“Š è°ƒè¯•å·¥å…·è¾“å‡ºåˆ†æ

### æˆåŠŸçš„è¾“å‡ºåº”è¯¥æ˜¯ï¼š

```
âœ… é’±åŒ…å·²è¿æ¥: 0x...
âœ… ç½‘ç»œ ChainId: 11155111
âœ… Relayer SDK å·²åŠ è½½
âœ… ç›´æ¥è®¿é—®çŠ¶æ€ç : 200
âœ… FHEVM å®ä¾‹åˆ›å»ºæˆåŠŸ
âœ… åŠ å¯†å®Œæˆ! è€—æ—¶: XXXms
âœ… handles[0] é•¿åº¦: 32
âœ… inputProof é•¿åº¦: XXX
```

### å¦‚æœçœ‹åˆ°é”™è¯¯ï¼š

#### é”™è¯¯1: "backend connection task has stopped"
```
âŒ åŠ å¯†æµ‹è¯•å¤±è´¥: backend connection task has stopped
ğŸ” å¯èƒ½åŸå› :
   1. Relayer æœåŠ¡æš‚æ—¶ä¸å¯ç”¨
   2. ç½‘ç»œè¿æ¥é—®é¢˜æˆ–é˜²ç«å¢™é˜»æ‹¦
   3. åˆçº¦åœ°å€é…ç½®é”™è¯¯
   4. ç”¨æˆ·åœ°å€æ ¼å¼é—®é¢˜
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. å°è¯•ä½¿ç”¨VPN
4. è”ç³»ZamaæŠ€æœ¯æ”¯æŒ

#### é”™è¯¯2: "SDK åŠ è½½è¶…æ—¶"
```
âŒ SDK åŠ è½½å¤±è´¥: Relayer SDK åŠ è½½è¶…æ—¶
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥CDNæ˜¯å¦å¯è®¿é—®
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### é”™è¯¯3: "CORSé”™è¯¯"
```
âŒ ç›´æ¥è®¿é—®å¤±è´¥: CORS policy
```

**è§£å†³æ–¹æ¡ˆ**:
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œåº”è¯¥ä½¿ç”¨ä»£ç†è®¿é—®
- æ£€æŸ¥Viteä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ”§ æ ¹æ®æµ‹è¯•ç»“æœçš„ä¿®å¤æ–¹æ¡ˆ

### åœºæ™¯A: RelayeræœåŠ¡ä¸å¯ç”¨

**ç—‡çŠ¶**: æ‰€æœ‰é…ç½®éƒ½è¿”å›400é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç­‰å¾…Zamaä¿®å¤æœåŠ¡
2. æŸ¥çœ‹ZamaçŠ¶æ€é¡µé¢
3. åœ¨ç¤¾åŒºè¯¢é—®

### åœºæ™¯B: é…ç½®é—®é¢˜

**ç—‡çŠ¶**: æŸä¸ªé…ç½®æˆåŠŸï¼ŒæŸä¸ªé…ç½®å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨æˆåŠŸçš„é…ç½®
2. æ›´æ–°é¡¹ç›®ä¸­çš„é…ç½®

### åœºæ™¯C: åˆçº¦åœ°å€é—®é¢˜

**ç—‡çŠ¶**: åŠ å¯†æˆåŠŸä½†åˆçº¦è°ƒç”¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. éªŒè¯åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®éƒ¨ç½²
2. æ£€æŸ¥åˆçº¦æ˜¯å¦åœ¨Sepoliaæµ‹è¯•ç½‘ä¸Š

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœè°ƒè¯•å·¥å…·æ˜¾ç¤ºé”™è¯¯ï¼Œè¯·ï¼š

1. **æˆªå›¾å®Œæ•´çš„æ—¥å¿—è¾“å‡º**
2. **è®°å½•æµ‹è¯•æ•°æ®éƒ¨åˆ†çš„ä¿¡æ¯**
3. **åœ¨ä»¥ä¸‹æ¸ é“å¯»æ±‚å¸®åŠ©**:
   - Zamaç¤¾åŒºè®ºå›: https://community.zama.ai/
   - Discord: https://discord.com/invite/zama
   - GitHub Issues: https://github.com/zama-ai/fhevm

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³è¿è¡Œè°ƒè¯•å·¥å…·**
   ```
   http://localhost:5173/src/test-relayer-debug.html
   ```

2. **æ ¹æ®æµ‹è¯•ç»“æœåˆ¤æ–­é—®é¢˜ç±»å‹**

3. **å¦‚æœæ˜¯RelayeræœåŠ¡é—®é¢˜**:
   - ç­‰å¾…æœåŠ¡æ¢å¤
   - åœ¨ç¤¾åŒºæŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–äººé‡åˆ°åŒæ ·é—®é¢˜

4. **å¦‚æœæ˜¯é…ç½®é—®é¢˜**:
   - ä½¿ç”¨è°ƒè¯•å·¥å…·æ‰¾åˆ°æ­£ç¡®çš„é…ç½®
   - æ›´æ–°é¡¹ç›®ä»£ç 

5. **å¦‚æœæ˜¯ç½‘ç»œé—®é¢˜**:
   - å°è¯•ä¸åŒçš„ç½‘ç»œç¯å¢ƒ
   - ä½¿ç”¨VPN

## ğŸ“ æŠ€æœ¯ç»†èŠ‚å‚è€ƒ

æ ¹æ®dev.mdæ–‡æ¡£ï¼š

### åŠ å¯†è¾“å…¥çš„æ­£ç¡®ä½¿ç”¨ï¼ˆç¬¬2000-2130è¡Œï¼‰

```typescript
// 1. åˆ›å»ºåŠ å¯†è¾“å…¥
const input = fhevm.createEncryptedInput(contractAddress, userAddress);

// 2. æ·»åŠ å€¼
input.add64(amount);  // å¯¹äºeuint64

// 3. åŠ å¯†
const encryptedInput = await input.encrypt();

// 4. è·å–ç»“æœ
const handle = encryptedInput.handles[0];
const proof = encryptedInput.inputProof;

// 5. è°ƒç”¨åˆçº¦
await contract.joinTable(tableId, handle, proof);
```

### ACLæƒé™ç®¡ç†ï¼ˆç¬¬2133-2204è¡Œï¼‰

```solidity
// åœ¨åˆçº¦ä¸­éªŒè¯å’Œä½¿ç”¨åŠ å¯†è¾“å…¥
function joinTable(
    uint256 tableId,
    externalEuint64 encryptedBuyIn,
    bytes calldata inputProof
) public {
    // éªŒè¯å¹¶è½¬æ¢
    euint64 buyIn = FHE.fromExternal(encryptedBuyIn, inputProof);
    
    // æˆäºˆæƒé™
    FHE.allowThis(buyIn);
    FHE.allow(buyIn, msg.sender);
    
    // ä½¿ç”¨åŠ å¯†å€¼
    player.balance = buyIn;
}
```

## âš ï¸ é‡è¦æç¤º

1. **ä¸è¦ä¿®æ”¹ç°æœ‰ä»£ç ** - è°ƒè¯•å·¥å…·æ˜¯ç‹¬ç«‹çš„
2. **è®°å½•æ‰€æœ‰æµ‹è¯•ç»“æœ** - ä¾¿äºåˆ†æé—®é¢˜
3. **è€å¿ƒç­‰å¾…** - RelayeræœåŠ¡é—®é¢˜éœ€è¦Zamaå›¢é˜Ÿä¿®å¤
4. **ä¿æŒæ›´æ–°** - å…³æ³¨Zamaç¤¾åŒºçš„æœ€æ–°æ¶ˆæ¯

---

**åˆ›å»ºæ—¶é—´**: 2025-10-23
**å·¥å…·ä½ç½®**: `/frontend/src/test-relayer-debug.html`
**æ–‡æ¡£å‚è€ƒ**: `/dev.md`
