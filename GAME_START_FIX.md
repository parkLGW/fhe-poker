# æ¸¸æˆå¯åŠ¨é—®é¢˜ä¿®å¤

## é—®é¢˜åˆ†æ

### é”™è¯¯ 1ï¼šè·Ÿæ³¨å¤±è´¥ - `0xbaf3f0f7` (InvalidState)
- **åŸå› **ï¼šæ¸¸æˆçŠ¶æ€ä¸å¯¹ï¼Œæ¸¸æˆè¿˜æœªå¼€å§‹

### é”™è¯¯ 2ï¼šåŠ æ³¨å¤±è´¥ - `"Game has not started"`
- **åŸå› **ï¼šåˆçº¦ä¸­çš„ `bet()` å‡½æ•°æ£€æŸ¥ `require(table.state != GameState.Waiting, "Game has not started")`
- æ¸¸æˆçŠ¶æ€ä»ç„¶æ˜¯ `Waiting` (0)

## æ ¹æœ¬åŸå› 

**GameNew.tsx ä¸­æ²¡æœ‰"å¼€å§‹æ¸¸æˆ"æŒ‰é’®ï¼**

- ç©å®¶è¿›å…¥æ¸¸æˆåï¼Œæ— æ³•å¼€å§‹æ¸¸æˆ
- æ¸¸æˆçŠ¶æ€ä¸€ç›´ä¿æŒåœ¨ `Waiting` çŠ¶æ€
- æ‰€ä»¥æ‰€æœ‰æ¸¸æˆæ“ä½œï¼ˆè·Ÿæ³¨ã€åŠ æ³¨ç­‰ï¼‰éƒ½ä¼šå¤±è´¥

## è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ "å¼€å§‹æ¸¸æˆ"æŒ‰é’®
åœ¨ `GameNew.tsx` ä¸­æ·»åŠ äº†ï¼š
- `isStartingGame` çŠ¶æ€å˜é‡
- `handleStartGame()` å‡½æ•°
- æ¸¸æˆæ“ä½œé¢æ¿ä¸­çš„"å¼€å§‹æ¸¸æˆ"æŒ‰é’®

### 2. æ”¹è¿›æ¸¸æˆæ“ä½œå‡½æ•°
ä¸ºæ‰€æœ‰æ¸¸æˆæ“ä½œå‡½æ•°æ·»åŠ äº†æ¸¸æˆçŠ¶æ€æ£€æŸ¥ï¼š
- `handleCheck()` - è¿‡ç‰Œ
- `handleCall()` - è·Ÿæ³¨
- `handleBet()` - åŠ æ³¨
- `handleFold()` - å¼ƒç‰Œ

è¿™æ ·å¯ä»¥åœ¨æ‰§è¡Œæ“ä½œå‰æ£€æŸ¥æ¸¸æˆæ˜¯å¦å·²å¼€å§‹ã€‚

## ä¿®æ”¹çš„æ–‡ä»¶

### `frontend/src/pages/GameNew.tsx`

**æ·»åŠ çš„å†…å®¹ï¼š**

1. **çŠ¶æ€å˜é‡**ï¼ˆç¬¬ 39 è¡Œï¼‰
   ```typescript
   const [isStartingGame, setIsStartingGame] = useState(false);
   ```

2. **handleStartGame å‡½æ•°**ï¼ˆç¬¬ 141-160 è¡Œï¼‰
   ```typescript
   const handleStartGame = async () => {
     try {
       setIsStartingGame(true);
       setLoading(true);
       console.log('ğŸ® å¼€å§‹æ¸¸æˆ:', { tableId });
       await contractService.startGame(tableId);
       console.log('âœ… æ¸¸æˆå·²å¼€å§‹');
       setError(null);
       setTimeout(() => {
         window.location.reload();
       }, 1000);
     } catch (err) {
       setError((err as Error).message);
       alert('å¼€å§‹æ¸¸æˆå¤±è´¥: ' + (err as Error).message);
     } finally {
       setIsStartingGame(false);
       setLoading(false);
     }
   };
   ```

3. **"å¼€å§‹æ¸¸æˆ"æŒ‰é’®**ï¼ˆç¬¬ 472-499 è¡Œï¼‰
   - **åªæœ‰åº„å®¶ï¼ˆdealerIndex = 0ï¼‰å¯ä»¥çœ‹åˆ°"å¼€å§‹æ¸¸æˆ"æŒ‰é’®**
   - å…¶ä»–ç©å®¶ä¼šçœ‹åˆ°"â³ ç­‰å¾…åº„å®¶å¼€å§‹æ¸¸æˆ..."çš„æç¤º
   - è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªç”¨æˆ·åŒæ—¶ç‚¹å‡»æŒ‰é’®

   ```typescript
   {gameState === 0 && playerCount >= 2 && (
     <div className="mb-4 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
       {(() => {
         const dealerIndex = state.tableInfo ? Number(state.tableInfo[5]) : null;
         const isDealer = myPlayerIndex !== null && dealerIndex !== null && myPlayerIndex === dealerIndex;

         if (isDealer) {
           return (
             <>
               <p className="text-yellow-800 font-semibold mb-3">â³ æ¸¸æˆè¿˜æœªå¼€å§‹ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ¸¸æˆ</p>
               <button
                 onClick={handleStartGame}
                 disabled={isStartingGame || state.isLoading}
                 className="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 text-white font-semibold py-3 px-4 rounded-lg transition"
               >
                 {isStartingGame ? 'å¼€å§‹ä¸­...' : 'ğŸ® å¼€å§‹æ¸¸æˆ'}
               </button>
             </>
           );
         } else {
           return (
             <p className="text-yellow-800 font-semibold">â³ ç­‰å¾…åº„å®¶å¼€å§‹æ¸¸æˆ...</p>
           );
         }
       })()}
     </div>
   )}
   ```

4. **æ”¹è¿›çš„æ¸¸æˆæ“ä½œå‡½æ•°**
   - æ‰€æœ‰æ“ä½œå‡½æ•°ï¼ˆcheckã€callã€betã€foldï¼‰ç°åœ¨éƒ½ä¼šæ£€æŸ¥æ¸¸æˆçŠ¶æ€
   - å¦‚æœæ¸¸æˆçŠ¶æ€æ˜¯ `Waiting` (0)ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼š"æ¸¸æˆè¿˜æœªå¼€å§‹ï¼Œè¯·ç­‰å¾…æ¸¸æˆå¼€å§‹"
   - å¦‚æœæ¸¸æˆçŠ¶æ€æ˜¯ `Finished` (6)ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼š"æ¸¸æˆå·²ç»“æŸï¼Œè¯·åˆ›å»ºæ–°æ¸¸æˆ"

## ä½¿ç”¨æµç¨‹

1. **è¿›å…¥æ¸¸æˆ**
   - ä»å¤§å…é€‰æ‹©æ¸¸æˆæ¡Œ
   - åŠ å…¥æ¸¸æˆï¼ˆéœ€è¦ >= 2 ä¸ªç©å®¶ï¼‰

2. **å¼€å§‹æ¸¸æˆ**
   - **åº„å®¶ï¼ˆç¬¬ä¸€ä¸ªç©å®¶ï¼‰**ä¼šçœ‹åˆ°é»„è‰²çš„"å¼€å§‹æ¸¸æˆ"æŒ‰é’®
   - **å…¶ä»–ç©å®¶**ä¼šçœ‹åˆ°"â³ ç­‰å¾…åº„å®¶å¼€å§‹æ¸¸æˆ..."çš„æç¤º
   - åº„å®¶ç‚¹å‡»æŒ‰é’®å¼€å§‹æ¸¸æˆ
   - é¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°

3. **æ¸¸æˆæ“ä½œ**
   - æ¸¸æˆå¼€å§‹åï¼Œæ‰€æœ‰ç©å®¶éƒ½å¯ä»¥è¿›è¡Œè¿‡ç‰Œã€è·Ÿæ³¨ã€åŠ æ³¨ã€å¼ƒç‰Œç­‰æ“ä½œ
   - å¦‚æœæ¸¸æˆè¿˜æœªå¼€å§‹ï¼Œæ“ä½œä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

## é˜²æ­¢é‡å¤ç‚¹å‡»

- âœ… **åªæœ‰åº„å®¶å¯ä»¥çœ‹åˆ°"å¼€å§‹æ¸¸æˆ"æŒ‰é’®**
- âœ… **å…¶ä»–ç©å®¶åªèƒ½çœ‹åˆ°ç­‰å¾…æç¤º**
- âœ… **é¿å…äº†å¤šä¸ªç”¨æˆ·åŒæ—¶ç‚¹å‡»çš„é—®é¢˜**
- âœ… **ç¡®ä¿æ¸¸æˆåªè¢«å¯åŠ¨ä¸€æ¬¡**

## æµ‹è¯•æ­¥éª¤

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://localhost:5173/`
2. è¿æ¥é’±åŒ…ï¼ˆMetaMaskï¼‰
3. è¿›å…¥æ¸¸æˆå¤§å…
4. åˆ›å»ºæˆ–åŠ å…¥æ¸¸æˆæ¡Œï¼ˆéœ€è¦ >= 2 ä¸ªç©å®¶ï¼‰
5. ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®
6. ç­‰å¾…é¡µé¢åˆ·æ–°
7. æµ‹è¯•æ¸¸æˆæ“ä½œï¼ˆè¿‡ç‰Œã€è·Ÿæ³¨ã€åŠ æ³¨ã€å¼ƒç‰Œï¼‰

## é¢„æœŸç»“æœ

- âœ… è¿‡ç‰ŒæˆåŠŸ
- âœ… è·Ÿæ³¨æˆåŠŸï¼ˆä¸å†æŠ¥ `0xbaf3f0f7` é”™è¯¯ï¼‰
- âœ… åŠ æ³¨æˆåŠŸï¼ˆä¸å†æŠ¥ "Game has not started" é”™è¯¯ï¼‰
- âœ… å¼ƒç‰ŒæˆåŠŸ

